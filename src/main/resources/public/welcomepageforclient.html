<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Welcome page for existing client </title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-CuOF+2SnTUfTwSZjCXf01h7uYhfOBuxIhGKPbfEJ3+FqH/s6cIFN9bGr1HmAg4fQ" crossorigin="anonymous">
</head>
<body class="content">
<div>
    <h1>This is your account page</h1>
    <h2>You have successfully logged in</h2>
    <div>
    <h5>Your clientID is: </h5>
        <p class="clientId"></p>
    </div>

    <label for="accountNo">Write your account number here</label>
    <input type="text" id="accountNo"><br><br>

    <input type="button" id="getBalanceButton" class="btn btn-info" value="GET BALANCE FOR THIS ACCOUNT"><br><br>
    <table id="balancesTable" border="1" align="center"></table><br><br>
    <p id="p"></p><br><br>

    <h6>Your accounts are listed here</h6>
    <table id="siiriTable" border="1" align="center"></table>
    <br><br>
    <form>
        <input type="submit" value="Create new account for me please">
    </form>
</div>
<script>

    // 1 - GET ACCOUNTS FOR THIS CLIENT

    // NETIST KOOD MIS VÕTAB URLILT query parameter id = väärtuse
    function get(name){
        if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
            return decodeURIComponent(name[1]);
    }
    let clientId = get("id");

    // fetch('http://localhost:8080/accountsforclient/' + 2)
    fetch('http://localhost:8080/accountsforclient/' + clientId)
        .then(result => result.json())
        .then(
            function (accounts) {
                console.log(accounts);
                let accountsTable = document.getElementById("siiriTable");

                // p.append(accounts);
                for (let i = 0; i < accounts.length; i++) {
                    let newRow = document.createElement("tr");
                    let newCell1 = document.createElement("td");
                    newCell1.innerText = accounts[i].id;
                    newRow.append(newCell1);
                    let newCell2 = document.createElement("td");
                    newCell2.innerText = accounts[i].accNo;
                    newRow.append(newCell2);
                    let newCell3 = document.createElement("td");
                    newCell3.innerText = accounts[i].balance;
                    newRow.append(newCell3);
                    let newCell4 = document.createElement("td");
                    newCell4.innerText = accounts[i].clientId;
                    newRow.append(newCell4);
                    accountsTable.append(newRow);

                    // ADD INTO TABLE
                    // let balancesTable = document.getElementById("balancesTable");
                    // let newRow = document.createElement("tr");
                    // let newCell = document.createElement("td");
                    // newRow.append(newCell);
                    // balancesTable.append(newRow);

                    // ADD INTO PARAGRAPH - 1
                    // let newElement = document.createElement("ol");
                    // newElement.innerHTML = balances;
                    // p.append(balances);

                    // ADD INTO PARAGRAPH - 2

                }
            }
            );


    // GET  BALANCE FOR ONE ACCOUNT
    let balanceButton = document.getElementById("getBalanceButton");
    balanceButton.onclick = function () {
        let accNo = document.getElementById("accountNo").value;
        fetch('http://localhost:8080/account/' + accNo)
            .then(result => result.json())
            .then(
                function (balances) {
                    // console.log(balances);

                    // ADD INTO TABLE
                    // let balancesTable = document.getElementById("balancesTable");
                    // let newRow = document.createElement("tr");
                    // let newCell = document.createElement("td");
                    // newRow.append(newCell);
                    // balancesTable.append(newRow);

                    // ADD INTO PARAGRAPH - 1
                    // let newElement = document.createElement("ol");
                    // newElement.innerHTML = balances;
                    // p.append(balances);

                    // ADD INTO PARAGRAPH - 2
                    p.append(balances);

                }
            )
    }
    // GET ACCOUNT LIST - DEPRECATED
    // fetch('http://localhost:8080/accountslist')
    //     .then(result => result.json())
    //     .then(
    //         function (accountslist) {
    //             // console.log(accountslist);
    //             let table = document.getElementById("siiriTable");
    //             for (let i = 0; i < accountslist.length; i++) {
    //                 let newRow = document.createElement("tr");
    //                 let newCell1 = document.createElement("td");
    //                 newCell1.innerText = accountslist[i].id;
    //                 newRow.append(newCell1);
    //                 let newCell2 = document.createElement("td");
    //                 newCell2.innerText = accountslist[i].accNo;
    //                 newRow.append(newCell2);
    //                 let newCell3 = document.createElement("td");
    //                 newCell3.innerText = accountslist[i].balance;
    //                 newRow.append(newCell3);
    //                 let newCell4 = document.createElement("td");
    //                 newCell4.innerText = accountslist[i].clientId;
    //                 newRow.append(newCell4);
    //                 table.append(newRow);
    //
    //                 console.log(accountslist[i]);
    //                 // console.log(table[i]);
    //
    //             }
    //         }
    //     );

    // GET ALL BALANCES - DEPRECATED
    // let balanceButton = document.getElementById("getBalanceButton");
    // balanceButton.onclick = function (){
    //     // fetch('http://localhost:8080/account/{accNo}'){
    //     fetch('http://localhost:8080/balances')
    //         .then(result => result.json())
    //         .then(
    //             function (balances){
    //                 let table2 = document.getElementById("balancesTable");
    //                 // let balance = document.getElementById("p");
    //                 for (let i = 0; i < balances.length; i++) {
    //                     let newRow = document.createElement("tr");
    //                     let newCell1 = document.createElement("td");
    //                     newCell1.innerText = balances[i];
    //                     newRow.append(newCell1);
    //                     table2.append(newRow);
    //                     console.log(balances[i]);
    //                 }
    //
    //             }
    //         )
    // };


</script>

</body>
</html>